/**
 * jquery-linkroll - v0.0.5 2018-05-09
 * A jQuery plugin to format a JSON bookmark file.
 * https://github.com/zachofalltrades/jquery.linkroll
 *
 * Copyright (c)2018 Zach Shelton
 * <zachofalltrades@users.sourceforge.net>  (http://zachofalltrades.net)
 * Released Under License:  MIT,GPL 
 */

!function(v,y,g,e){"use strict";var b=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,n="//www.google.com/s2/favicons?domain=",k=["append","prepend","before","after","html"],C="https://jsonp.nodejitsu.com/?callback=?&url=",A="https://jsonblob.com",E="/api/jsonBlob",O=y.File&&y.FileReader&&y.FileList,i=y.console&&y.console.log&&!0,S=31536e6;function r(e,n){var a=!1,o=!1,l=!1,t=!1,s=n,c=n.attr("id"),d=null,p=null,u=this;function h(e){var n=u.options,i=n.jsonTemplate,r=n.onSuccess;p=function(e){var n={};Array.isArray(e)&&0<e.length&&"string"==typeof e[0].category&&Array.isArray(e[0].links)?(n.name="old format",n.children=(i=e,r=[],v.each(i,function(e,n){if(n.category){var t=[];Array.isArray(n.links)&&v.each(n.links,function(e,n){if("string"==typeof n){var i={name:b.exec(n)[11],uri:n};t.push(i)}else if("string"==typeof n.link){var r={name:n.name,uri:n.link};t.push(r)}});var i={name:n.category,children:t};r.push(i)}}),T(i),r)):"text/x-moz-place-container"===e.type?(n.name="Mozilla Bookmarks",n.children=function e(n){var i=[];if(Array.isArray(n.children))for(var r in n.children){var t=n.children[r];if("text/x-moz-place-container"===t.type&&Array.isArray(t.children)&&0<t.children.length){var a=e(t),o={name:t.title,children:a};i.push(o)}else if("text/x-moz-place"===t.type){var l={name:t.title,uri:t.uri};i.push(l)}}return i}(e)):"object"==typeof e.roots&&"object"==typeof e.roots.other?(n.name="Chrome Bookmarks",n.children=function e(n){var i=[];if(Array.isArray(n.children))for(var r in n.children){var t=n.children[r];if("folder"===t.type&&Array.isArray(t.children)&&0<t.children.length){var a=e(t),o={name:t.name,children:a};i.push(o)}else if("url"===t.type){var l={name:t.name,uri:t.url};i.push(l)}}return i}(e.roots.other)):"string"==typeof e.name&&Array.isArray(e.children)?n=e:(n.name="!!!!!!!   UNEXPECTED FORMAT   !!!!!!!!!",n.children=[]);var i,r;return T(n.name),n}(e);var t=[];i.begin&&t.push(i.begin),function e(n,i,r){if(Array.isArray(r.children))for(var t in r.children){var a=r.children[t];Array.isArray(a.children)?(n.push(i.beforeEachCategory+a.name+i.afterEachCategory),n.push(i.beforeChildren),e(n,i,a),n.push(i.afterChildren)):"string"==typeof a.uri?(i.beforeEachLink&&n.push(j(a,i.beforeEachLink,i)),i.eachLink&&n.push(j(a,i.eachLink,i)),i.afterEachLink&&n.push(j(a,i.afterEachLink,i))):(T("!!!!!! UNEXPECTED OBJECT !!!!!!"),T(a))}else T("!!!!!!!!!!  NOT A FOLDER   !!!!!!!!"),T(r)}(t,i,p),i.end&&t.push(i.end),s.html(t.join("")),n.addClass&&s.addClass(n.addClass),a&&a.prop("disabled",!1),l&&l.prop("disabled",!1),o&&o.prop("disabled",!1),v.isFunction(r)&&r(s)}function f(e){d=e,t&&(""===d?t.prop("disabled",!0):(t.prop("disabled",!1),t.attr("title","reload from '"+d+"'"))),u.options.enableCookie&&c&&function(e,n){var i=new Date;i.setTime(i.getTime()+S);var r=e+"="+y.escape(n)+"; expires="+i.toGMTString();T(r),g.cookie=r}(c+"-jsonUrl",d)}function m(i){var e,r=i;(u.options.useProxy&&-1===i.indexOf(C)&&(r=C+i),u.options.allowCaching)||(e={cacheBuster:(new Date).getTime()});v.getJSON(r,e).done(function(e,n){T("getJSON: '"+n+"' from "+r),f(i),h(e)}).fail(function(e,n,i){T("getJSON: '"+n+"' from "+r),T(i),T(e)})}!function(e){u.options=v.extend({},v.fn.linkroll.defaults,e),u.options.method=v.inArray(u.options.method,k)?u.options.method:k[0];var n=function(e){var n=e||!1;if(!n)return!1;if(!0===n)return n={file:!0,url:!0,raw:!0,edit:!0,reload:!0,clear:!0};if("object"==typeof n)for(var i in n)if(!0===n[i])return n;return!1}(u.options.buttons);if(n){var i=v("<div/>");if(n.file&&O&&i.append(function(t){var e=v("<span/>"),n=v("<input />",{type:"file",css:{visibility:"hidden",width:0,height:0}});n.attr("accept","json"),n.on("change",function(e){var n=e.target.files,i=n[0],r=new y.FileReader;r.onload=function(e){var n=e.target.result,i=JSON.parse(n);t(i)},r.readAsText(i,"UTF-8")});var i=v("<button/>",{type:"button"});return i.html("load from file"),i.click(function(){n.click()}),e.append(i),e.append(n),e}(h)),n.url&&i.append(function(n){var e=v("<span/>"),i=v("<input />",{type:"text",size:"100"});i.bind("keypress",function(e){13===e.keyCode&&(e.preventDefault(),n(i.val()))});var r=v("<button/>",{type:"button"});return r.html("load from url"),r.click(function(){n(i.val())}),e.append(r),e.append(i),e}(m)),n.raw&&O&&((a=v("<button/>",{type:"button",disabled:!0})).html("export"),a.click(function(){var e=p,n=JSON.stringify(e,null," "),i=new y.Blob([n],{type:"application/json"});x(y.URL.createObjectURL(i),"LinkRoller Data")}),i.append(a)),n.edit&&O&&((o=v("<button/>",{type:"button",disabled:!0})).html("edit"),o.click(function(){if(d&&-1<d.indexOf(A))x(d.replace(E,""),"editing via JSONBlob service, save here, then reload");else{var e=JSON.stringify(p);v.ajax({url:A+E,contentType:"application/json; charset=utf-8",type:"POST",data:e,error:function(e,n){y.alert(n)},success:function(e,n,i){f(i.getResponseHeader("location")),x(d.replace(E,""),"editing via JSONBlob service, save here, then reload")}})}}),i.append(o)),n.reload&&(t=v("<button/>",{disabled:!0}).html("reload").click(function(){m(d)}),v.isFunction(t.tooltip)&&t.tooltip(),i.append(t)),n.clear&&(l=v("<button/>",{disabled:!0}).html("clear").click(function(){s.empty(),l.prop("disabled",!0)}),i.append(l)),s.before(i),u.options.enableCookie&&c){var r=function(e){var n=g.cookie;T(n);var i=e+"=",r=n.indexOf(i);if(-1===r)return null;r+=i.length;var t=n.indexOf(";",r);-1===t&&(t=n.length),T("begin: "+r+" -- end:"+t);var a=n.substring(r,t);T("substring: "+a);var o=y.unescape(a);return T("value: "+o),o}(c+"-jsonUrl");r&&!d&&m(r)}u.isWidget=!0}u.options.jsonUrl&&(null===p&&m(u.options.jsonUrl),u.isWidget=!0)}(e)}function o(e){return n+b.exec(e)[11]}function j(e,n,i){var r="string"==typeof e.uri?e.uri:e,t="string"==typeof e.name?e.name:b.exec(r)[11],a=n.replace(i.replaceWithIconUrl,o(r));return a=(a=a.replace(i.replaceWithSiteUrl,r)).replace(i.replaceWithSiteName,t)}function x(e,n){var i=n||"LinkRoller";if(v.isFunction(v.fn.dialog)){var r=y.innerHeight-10,t=y.innerWidth-10,a=v("<iframe height='"+(r-100)+"' width='"+(t-100)+"' frameborder='0' marginwidth='0' marginheight='0' src='"+e+"' />"),o=v("<div id='mydialog' />");o.append(a),v("body").append(o),o.dialog({title:i,modal:!0,resizable:!0,height:"auto",width:t,close:function(){o.remove()}})}else{y.open(e,i).focus()}}function T(e){i&&y.console.log(e)}v.fn.linkroll=function(i){return this.each(function(){var e=v(this),n=new r(i,e);n.isWidget||(e.is("a")?n.insertImage(e):e.find("a").each(function(){var e=v(this);n.insertImage(e)}),v.isFunction(n.options.onSuccess)&&n.options.onSuccess(e))})},v.fn.linkroll.methods=function(){return k.slice()},v.fn.linkroll.defaults={addClass:"linkroll",method:"append",jsonUrl:!1,enableCookie:!0,allowCaching:!1,useProxy:!1,onSuccess:!1,buttons:{file:!1,url:!1,raw:!1,edit:!1,reload:!1,clear:!1},jsonTemplate:{begin:"<div>",beforeEachCategory:"<h3>",eachCategory:"<h3 class='linkroll-cat'>##CATEGORY##</h3>",afterEachCategory:"</h3>",beforeChildren:"<div><ul>",afterChildren:"</ul></div>",beforeEachLink:"",eachLink:"<li class='linkroll-item' style=\"list-style-image: url('##ICONURL##');\"><a href='##SITEURL##'>##SITENAME##</a></li>",afterEachLink:"",end:"</div>",replaceWithCategory:"##CATEGORY##",replaceWithIconUrl:"##ICONURL##",replaceWithSiteUrl:"##SITEURL##",replaceWithSiteName:"##SITENAME##"}},r.prototype={options:{},isWidget:!1,insertImage:function(e){var n=o(v(e).attr("href")),i=v("<img />",{src:n});this.options.addClass&&(i.addClass(this.options.addClass),e.addClass(this.options.addClass)),e[this.options.method].call(e,i)}}}(jQuery,window,document);